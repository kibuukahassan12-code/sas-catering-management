{% extends "base.html" %}
{% block content %}
<section class="page-header">
    <div>
        <h1>Quotation #{{ quotation.id }}</h1>
        <p class="muted">Date: {{ quotation.created_at.strftime('%Y-%m-%d') if quotation.created_at else 'â€”' }}</p>
    </div>
    <div class="quick-links">
        <a href="{{ url_for('client_portal.quotes') }}" class="btn-secondary">Back to Quotes</a>
        {% if quotation.status == 'Sent' %}
        <button onclick="approveQuote({{ quotation.id }})" class="btn-primary">Approve Quotation</button>
        {% endif %}
    </div>
</section>

<section class="panel">
    <div class="panel-header">
        <h3>Quotation Details</h3>
        <span class="badge badge-{{ quotation.status.lower() }}">{{ quotation.status }}</span>
    </div>
    
    <div style="padding: 1.5rem;">
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
            <div><strong>Total Amount:</strong><br><h3>{{ CURRENCY }}{{ "%.2f"|format(quotation.total_amount) if quotation.total_amount else '0.00' }}</h3></div>
        </div>
        
        {% if lines %}
        <div class="table-wrapper">
            <table>
                <thead>
                    <tr>
                        <th>Item</th>
                        <th>Quantity</th>
                        <th>Unit Price</th>
                        <th>Subtotal</th>
                    </tr>
                </thead>
                <tbody>
                    {% for line in lines %}
                    <tr>
                        <td>{{ line.description or 'Item' }}</td>
                        <td>{{ line.quantity }}</td>
                        <td>{{ CURRENCY }}{{ "%.2f"|format(line.unit_price) if line.unit_price else '0.00' }}</td>
                        <td>{{ CURRENCY }}{{ "%.2f"|format(line.subtotal) if line.subtotal else '0.00' }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}
    </div>
</section>

<script>
function approveQuote(quoteId) {
    if (confirm('Approve this quotation?')) {
        fetch(`/client/quote/${quoteId}/approve`, {method: 'POST'})
            .then(r => r.json())
            .then(data => {
                if (data.success) {
                    alert('Quotation approved!');
                    location.reload();
                } else {
                    alert('Error: ' + (data.error || 'Unknown error'));
                }
            });
    }
}
</script>
{% endblock %}

