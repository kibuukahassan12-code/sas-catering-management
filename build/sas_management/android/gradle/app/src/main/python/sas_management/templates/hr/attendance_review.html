{% extends "base.html" %}
{% block content %}
<section class="page-header">
    <div>
        <p class="eyebrow">HR Department</p>
        <h1>Attendance Review</h1>
        <p class="muted">Review and approve attendance records.</p>
    </div>
    <div class="quick-links">
        <a class="btn-secondary" href="{{ url_for('hr.dashboard') }}">‚Üê Back to Dashboard</a>
    </div>
</section>

<!-- Date Range Filter -->
<section class="panel">
    <form method="get" class="form-grid">
        <label class="form-control">
            <span>Start Date</span>
            <input type="date" name="start_date" value="{{ start_date.isoformat() if start_date else '' }}">
        </label>
        <label class="form-control">
            <span>End Date</span>
            <input type="date" name="end_date" value="{{ end_date.isoformat() if end_date else '' }}">
        </label>
        <div class="form-actions">
            <button type="submit" class="btn-primary">Load Records</button>
        </div>
    </form>
</section>

<!-- Attendance Table -->
<section class="panel">
    <div class="panel-header">
        <h3>Attendance Records</h3>
        <span class="badge">{{ attendances|length }} record(s)</span>
    </div>
    
    {% if attendances %}
    <div class="table-wrapper">
        <table>
            <thead>
                <tr>
                    <th>Employee</th>
                    <th>Date</th>
                    <th>Clock In</th>
                    <th>Clock Out</th>
                    <th>Hours Worked</th>
                    <th>Notes</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for attendance in attendances %}
                <tr>
                    <td>
                        <strong>{{ attendance.employee.full_name }}</strong>
                        {% if attendance.employee.employee_number %}
                        <br><small class="muted">#{{ attendance.employee.employee_number }}</small>
                        {% endif %}
                        {% if attendance.employee.department %}
                        <br><small class="muted">{{ attendance.employee.department.name }}</small>
                        {% endif %}
                    </td>
                    <td>{{ attendance.date.strftime('%Y-%m-%d') if attendance.date else (attendance.clock_in.strftime('%Y-%m-%d') if attendance.clock_in else 'N/A') }}</td>
                    <td>
                        {% if attendance.clock_in %}
                        {{ attendance.clock_in.strftime('%H:%M') }}
                        {% else %}
                        <span class="muted">‚Äî</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if attendance.clock_out %}
                        {{ attendance.clock_out.strftime('%H:%M') }}
                        {% else %}
                        <span class="muted">‚Äî</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if attendance.hours_worked %}
                        <strong>{{ "%.2f"|format(attendance.hours_worked) }} hrs</strong>
                        {% else %}
                        <span class="muted">‚Äî</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if attendance.notes %}
                        <span title="{{ attendance.notes }}">üìù</span>
                        {% else %}
                        <span class="muted">‚Äî</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if attendance.status == 'Present' %}
                        <span class="badge" style="background: #2ecc71; color: white;">Present</span>
                        {% elif attendance.status == 'Late' %}
                        <span class="badge" style="background: #f39c12; color: white;">Late</span>
                        {% elif attendance.status == 'Absent' %}
                        <span class="badge" style="background: #e74c3c; color: white;">Absent</span>
                        {% else %}
                        <span class="badge" style="background: #95a5a6; color: white;">{{ attendance.status or 'Pending' }}</span>
                        {% endif %}
                    </td>
                    <td>
                        <a href="#" class="btn-ghost btn-sm" title="View Details">View</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div style="padding: 3rem; text-align: center;">
        <p class="muted" style="font-size: 1.1rem; margin-bottom: 0.5rem;">No attendance records found</p>
        <p class="muted">Try adjusting the date range or create attendance records.</p>
    </div>
    {% endif %}
</section>

<!-- Summary Statistics -->
{% if attendances %}
<section class="panel">
    <div class="panel-header">
        <h3>Summary Statistics</h3>
    </div>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem;">
        <div style="text-align: center; padding: 1rem; background: #f8f9fa; border-radius: 8px;">
            <p style="margin: 0; font-size: 0.875rem; color: #6c757d;">Total Records</p>
            <h2 style="margin: 0.5rem 0 0 0; color: #212529;">{{ total_records }}</h2>
        </div>
        <div style="text-align: center; padding: 1rem; background: #f8f9fa; border-radius: 8px;">
            <p style="margin: 0; font-size: 0.875rem; color: #6c757d;">Present</p>
            <h2 style="margin: 0.5rem 0 0 0; color: #2ecc71;">{{ present_count }}</h2>
        </div>
        <div style="text-align: center; padding: 1rem; background: #f8f9fa; border-radius: 8px;">
            <p style="margin: 0; font-size: 0.875rem; color: #6c757d;">Late</p>
            <h2 style="margin: 0.5rem 0 0 0; color: #f39c12;">{{ late_count }}</h2>
        </div>
        <div style="text-align: center; padding: 1rem; background: #f8f9fa; border-radius: 8px;">
            <p style="margin: 0; font-size: 0.875rem; color: #6c757d;">Total Hours</p>
            <h2 style="margin: 0.5rem 0 0 0; color: #212529;">{{ "%.1f"|format(total_hours or 0) }}</h2>
        </div>
    </div>
</section>
{% endif %}

<style>
.table-wrapper {
    overflow-x: auto;
}

table {
    width: 100%;
    border-collapse: collapse;
}

table thead {
    background: #f8f9fa;
}

table th {
    padding: 0.75rem;
    text-align: left;
    font-weight: 600;
    font-size: 0.875rem;
    color: #495057;
    border-bottom: 2px solid #dee2e6;
}

table td {
    padding: 1rem 0.75rem;
    border-bottom: 1px solid #e9ecef;
}

table tbody tr:hover {
    background: #f8f9fa;
}

.badge {
    display: inline-block;
    padding: 0.25rem 0.75rem;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.muted {
    color: #6c757d;
    font-size: 0.875rem;
}
</style>
{% endblock %}


