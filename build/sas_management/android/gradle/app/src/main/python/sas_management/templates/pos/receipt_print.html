<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Receipt - {{ receipt.receipt_ref }}</title>
    <style>
        @media print {
            body { margin: 0; padding: 0; }
            .no-print { display: none !important; }
            @page { size: 80mm auto; margin: 0; }
        }
        
        body {
            font-family: 'Courier New', monospace;
            font-size: 12px;
            width: 80mm;
            margin: 0 auto;
            padding: 10px;
            background: white;
            color: #000;
        }
        
        .receipt-header {
            text-align: center;
            border-bottom: 2px dashed #000;
            padding-bottom: 10px;
            margin-bottom: 10px;
        }
        
        .receipt-header h1 {
            margin: 5px 0;
            font-size: 16px;
            font-weight: bold;
        }
        
        .receipt-header p {
            margin: 2px 0;
            font-size: 10px;
        }
        
        .receipt-meta {
            margin: 10px 0;
            font-size: 11px;
        }
        
        .receipt-meta p {
            margin: 3px 0;
        }
        
        .receipt-items {
            margin: 10px 0;
            border-top: 1px dashed #000;
            border-bottom: 1px dashed #000;
            padding: 10px 0;
        }
        
        .receipt-item {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
            font-size: 11px;
        }
        
        .receipt-item-name {
            flex: 1;
        }
        
        .receipt-item-qty {
            margin: 0 10px;
            text-align: center;
            min-width: 30px;
        }
        
        .receipt-item-price {
            text-align: right;
            min-width: 60px;
        }
        
        .receipt-totals {
            margin: 10px 0;
            font-size: 11px;
        }
        
        .receipt-total-row {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
        }
        
        .receipt-total-row.total {
            font-weight: bold;
            font-size: 13px;
            border-top: 2px solid #000;
            padding-top: 5px;
            margin-top: 10px;
        }
        
        .receipt-footer {
            text-align: center;
            margin-top: 15px;
            padding-top: 10px;
            border-top: 2px dashed #000;
            font-size: 10px;
        }
        
        .print-actions {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 1000;
        }
        
        .print-btn {
            padding: 10px 20px;
            margin: 5px;
            background: #f26822;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .print-btn:hover {
            background: #d55a1a;
        }
        
        .close-btn {
            background: #666;
        }
        
        .close-btn:hover {
            background: #555;
        }
    </style>
</head>
<body>
    <div class="no-print print-actions">
        <button class="print-btn" onclick="window.print()">Print Receipt</button>
        <button class="print-btn close-btn" onclick="window.close()">Close</button>
    </div>
    
    <div class="receipt-header">
        <h1>SAS BEST FOODS</h1>
        <p>Specialists in Luxury Catering</p>
        <p>Near Akamwesi Mall, Gayaza Rd</p>
        <p>Opp Electoral Commission Kawempe Offices</p>
        <p>Kawempe, Kampala, Uganda</p>
        <p>Tel: 0702060778 / 0745705088</p>
        <p>Website: www.sasbestfoods.com</p>
    </div>
    
    <div class="receipt-meta">
        <p><strong>Receipt:</strong> {{ receipt.receipt_ref }}</p>
        <p><strong>Order:</strong> {{ order.reference }}</p>
        {% set receipt_time = receipt.issued_at or payment.payment_time or order.order_time %}
        <p><strong>Date:</strong> {{ receipt_time.strftime('%d/%m/%Y') if receipt_time else 'N/A' }}</p>
        <p><strong>Time:</strong> {{ receipt_time.strftime('%I:%M:%S %p') if receipt_time else 'N/A' }}</p>
        {% if payment.method %}
        <p><strong>Payment:</strong> {{ payment.method|upper }}</p>
        {% endif %}
        {% if payment.ref %}
        <p><strong>Ref:</strong> {{ payment.ref }}</p>
        {% endif %}
    </div>
    
    <div class="receipt-items">
        {% for line in order.lines %}
        <div class="receipt-item">
            <span class="receipt-item-name">{{ line.product_name }}</span>
            <span class="receipt-item-qty">{{ line.qty }}</span>
            <span class="receipt-item-price">{{ CURRENCY }}{{ "{:,.2f}".format(line.line_total) }}</span>
        </div>
        {% endfor %}
    </div>
    
    <div class="receipt-totals">
        <div class="receipt-total-row">
            <span>Subtotal:</span>
            <span>{{ CURRENCY }}{{ "{:,.2f}".format(order.total_amount - order.tax_amount - order.discount_amount) }}</span>
        </div>
        {% if order.discount_amount > 0 %}
        <div class="receipt-total-row">
            <span>Discount:</span>
            <span>-{{ CURRENCY }}{{ "{:,.2f}".format(order.discount_amount) }}</span>
        </div>
        {% endif %}
        {% if order.tax_amount > 0 %}
        <div class="receipt-total-row">
            <span>Tax (18%):</span>
            <span>{{ CURRENCY }}{{ "{:,.2f}".format(order.tax_amount) }}</span>
        </div>
        {% endif %}
        <div class="receipt-total-row total">
            <span>TOTAL:</span>
            <span>{{ CURRENCY }}{{ "{:,.2f}".format(order.total_amount) }}</span>
        </div>
        <div class="receipt-total-row">
            <span>Paid:</span>
            <span>{{ CURRENCY }}{{ "{:,.2f}".format(payment.amount) }}</span>
        </div>
        {% if payment_summary.remaining > 0 %}
        <div class="receipt-total-row">
            <span>Change:</span>
            <span>{{ CURRENCY }}{{ "{:,.2f}".format(payment.amount - order.total_amount) }}</span>
        </div>
        {% endif %}
    </div>
    
    <div class="receipt-footer">
        <p>Thank you for your business!</p>
        <p>Visit us again</p>
    </div>
    
    <script>
        // Auto-print if configured
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('autoprint') === 'true') {
            window.onload = function() {
                setTimeout(function() {
                    window.print();
                    // Close window after print (if popup)
                    if (window.opener) {
                        setTimeout(function() {
                            window.close();
                        }, 500);
                    }
                }, 500);
            };
        }
    </script>
</body>
</html>

