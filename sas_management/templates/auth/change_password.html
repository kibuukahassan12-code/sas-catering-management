{% extends "base.html" %}
{% block content %}
<section class="page-header">
    <div>
        <p class="eyebrow">Security</p>
        <h1>Change Password</h1>
        <p class="muted">
            {% if must_change or current_user.force_password_change or current_user.must_change_password %}
            You must change your password before continuing.
            {% else %}
            Update your account password.
            {% endif %}
        </p>
    </div>
</section>

<section class="panel">
    <form method="post" class="form-grid">
        {% if is_first_login or not (must_change or current_user.force_password_change or current_user.must_change_password) %}
        <label class="form-control">
            <span>Current Password</span>
            <input type="password" name="old_password" required autocomplete="current-password">
            {% if is_first_login %}
            <small class="muted">Please enter the temporary password provided by your administrator.</small>
            {% endif %}
        </label>
        {% endif %}
        
        <label class="form-control">
            <span>New Password</span>
            <input type="password" name="new_password" required autocomplete="new-password" minlength="8" placeholder="Minimum 8 characters">
            <small class="muted">Password must be at least 8 characters long.</small>
        </label>
        
        <label class="form-control">
            <span>Confirm New Password</span>
            <input type="password" name="confirm_password" required autocomplete="new-password" minlength="8" placeholder="Re-enter new password">
        </label>
        
        <div class="form-actions">
            <button type="submit" class="btn-primary">Change Password</button>
            {% if not (must_change or current_user.force_password_change or current_user.must_change_password) %}
            <a href="{{ url_for('core.dashboard') }}" class="btn-ghost">Cancel</a>
            {% endif %}
        </div>
    </form>
</section>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const form = document.querySelector("form");
    const newPassword = document.querySelector('input[name="new_password"]');
    const confirmPassword = document.querySelector('input[name="confirm_password"]');
    
    form.addEventListener("submit", function(e) {
        if (newPassword.value !== confirmPassword.value) {
            e.preventDefault();
            alert("New passwords do not match!");
            confirmPassword.focus();
            return false;
        }
        
        if (newPassword.value.length < 8) {
            e.preventDefault();
            alert("Password must be at least 8 characters long!");
            newPassword.focus();
            return false;
        }
    });
});
</script>
{% endblock %}

