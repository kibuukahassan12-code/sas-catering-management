{% extends "base.html" %}
{% block content %}
<section class="page-header">
    <div>
        <h1>My Quotations</h1>
    </div>
    <div class="quick-links">
        <a href="{{ url_for('client_portal.dashboard') }}" class="btn-secondary">Back to Dashboard</a>
    </div>
</section>

<section class="panel">
    <div class="table-wrapper">
        <table>
            <thead>
                <tr>
                    <th>Quote #</th>
                    <th>Date</th>
                    <th>Amount</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for quote in quotations %}
                <tr>
                    <td><strong>#{{ quote.id }}</strong></td>
                    <td>{{ quote.created_at.strftime('%Y-%m-%d') if quote.created_at else 'â€”' }}</td>
                    <td>{{ CURRENCY }}{{ "%.2f"|format(quote.total_amount) if quote.total_amount else '0.00' }}</td>
                    <td><span class="badge badge-{{ quote.status.lower() }}">{{ quote.status }}</span></td>
                    <td>
                        <a href="{{ url_for('client_portal.view_quote', quote_id=quote.id) }}" class="btn-ghost btn-sm">View</a>
                        {% if quote.status == 'Sent' %}
                        <button onclick="approveQuote({{ quote.id }})" class="btn-primary btn-sm">Approve</button>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</section>

<script>
function approveQuote(quoteId) {
    if (confirm('Approve this quotation?')) {
        fetch(`/client/quote/${quoteId}/approve`, {method: 'POST'})
            .then(r => r.json())
            .then(data => {
                if (data.success) {
                    location.reload();
                } else {
                    alert('Error: ' + (data.error || 'Unknown error'));
                }
            });
    }
}
</script>
{% endblock %}

