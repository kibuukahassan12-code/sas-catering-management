{% extends "base.html" %}
{% block content %}
<section class="page-header">
    <div>
        <p class="eyebrow">Internal Communication</p>
        <h1>Announcements</h1>
        <p class="muted">Company-wide announcements and updates.</p>
    </div>
    <div class="quick-links">
        {# ALL PERMISSIONS GRANTED - No restrictions #}
        <a class="btn-primary" href="{{ url_for('communication.announcement_new') }}">+ New Announcement</a>
        <a class="btn-secondary" href="{{ url_for('communication.dashboard') }}">← Dashboard</a>
    </div>
</section>

{% if announcements %}
<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 1.5rem;">
    {% for announcement in announcements %}
    <article class="panel" style="cursor: pointer;" onclick="window.location='{{ url_for('communication.announcement_view', announcement_id=announcement.id) }}'">
        {% if announcement.image_url %}
        <img src="{{ url_for('communication.serve_upload', filename=announcement.image_url.split('/')[-1]) }}" 
             alt="{{ announcement.title }}" 
             style="width: 100%; max-height: 200px; object-fit: cover; border-radius: 8px; margin-bottom: 1rem;">
        {% endif %}
        <h3 style="margin: 0 0 0.5rem 0;">{{ announcement.title }}</h3>
        <p style="color: rgba(255,255,255,0.8); margin-bottom: 0.5rem;">
            {{ announcement.message[:150] }}{% if announcement.message|length > 150 %}...{% endif %}
        </p>
        <small class="muted">
            By {{ announcement.creator.email if announcement.creator else 'Unknown' }} • 
            {{ announcement.created_at.strftime('%Y-%m-%d %H:%M') if announcement.created_at else '' }}
        </small>
    </article>
    {% endfor %}
</div>
{% else %}
<section class="panel">
    <p class="muted" style="text-align: center; padding: 2rem;">No announcements yet.</p>
</section>
{% endif %}
{% endblock %}

