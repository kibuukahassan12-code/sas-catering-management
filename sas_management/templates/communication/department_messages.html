{% extends "base.html" %}
{% block content %}
<section class="page-header">
    <div>
        <p class="eyebrow">{{ department }} Department</p>
        <h1>Department Messages</h1>
    </div>
    <a class="btn-secondary" href="{{ url_for('communication.dashboard') }}">â† Dashboard</a>
</section>

<section class="panel">
    <div class="panel-header">
        <h3>Send Message to {{ department }} Department</h3>
    </div>
    <form method="POST" action="{{ url_for('communication.department_send', department=department) }}" enctype="multipart/form-data">
        <textarea name="message" rows="4" placeholder="Type your message..." required style="width: 100%; padding: 0.75rem; border-radius: 8px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white; resize: vertical;"></textarea>
        <div style="margin-top: 0.5rem; display: flex; gap: 0.5rem; align-items: center;">
            <input type="file" name="attachment" accept="image/*,.pdf,.doc,.docx,.txt">
            <button type="submit" class="btn-primary">Send</button>
        </div>
    </form>
</section>

<section class="panel">
    <div class="panel-header">
        <h3>Messages</h3>
    </div>
    {% if messages %}
    <div style="display: flex; flex-direction: column; gap: 1rem;">
        {% for message in messages %}
        <div style="padding: 1rem; background: rgba(255,255,255,0.05); border-radius: 8px;">
            <div style="white-space: pre-wrap; margin-bottom: 0.5rem;">{{ message.message }}</div>
            {% if message.attachment %}
            <div style="margin-bottom: 0.5rem;">
                <a href="{{ url_for('communication.serve_upload', filename=message.attachment.split('/')[-1]) }}" 
                   target="_blank" 
                   class="btn-ghost btn-sm">ğŸ“ View Attachment</a>
            </div>
            {% endif %}
            <small class="muted">
                By {{ message.sender.email if message.sender else 'Unknown' }} â€¢ 
                {{ message.created_at.strftime('%Y-%m-%d %H:%M') if message.created_at else '' }}
            </small>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <p class="muted" style="text-align: center; padding: 2rem;">No messages yet.</p>
    {% endif %}
</section>
{% endblock %}

